<!-- ðŸŸ¢ index.html -->
<!-- ðŸŸ¢ index.html â€” start of file -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, viewport-fit=cover"
  />
  <title>The Oklahoma Observer</title>
  <link rel="icon" href="favicon.ico" />
  <meta name="theme-color" content="#1E90FF" />

  <!-- Performance: preconnect to API proxy -->
  <link rel="preconnect" href="https://okobserver-proxy.bob-b5c.workers.dev" />
  <link rel="dns-prefetch" href="https://okobserver-proxy.bob-b5c.workers.dev" />

  <!-- CSS -->
  <link
    rel="preload"
    href="override.css?v=2026-01-05R066"
    as="style"
  />
  <link
    rel="stylesheet"
    href="override.css?v=2026-01-05R066"
  />

  <!-- Main SPA entry -->
  <script
    defer
    src="main.js?v=2026-01-05R066"
  ></script>
  <script
    defer
    src="PostDetail.js?v=2026-01-05R066"
  ></script>
</head>
<body>
  <header class="oo-header" role="banner" aria-label="Site header">
    <div class="oo-header-inner">
      <!-- Left spacer so the center column can truly center the brand -->
      <div aria-hidden="true"></div>

      <a class="oo-brand" href="#/">
        <img class="oo-logo" src="logo.png" alt="The Oklahoma Observer" />
        <div class="oo-motto">
          To Comfort The Afflicted And Afflict The Comfortable
        </div>
      </a>

      <button
        class="oo-hamburger"
        data-oo="hamburger"
        aria-label="Menu"
        aria-expanded="false"
        aria-controls="oo-menu"
      >
        â‰¡
      </button>
    </div>
  </header>

  <!-- Overlay + Menu (hamburger) -->
  <div class="oo-overlay" data-oo="overlay" hidden></div>
  <nav 
    class="oo-menu"
    id="oo-menu"
    data-oo="menu"
    aria-label="Main navigation"
  >
    <ul class="oo-menu-list">
      <li><a href="#/">News</a></li>
      <li>
  <a href="https://www.facebook.com/pages/128452876107?sk=events"
     rel="noopener">
    Events
  </a>
</li>
      <li><a href="#/search">Search</a></li>
      <li><a href="#/about">About</a></li>
      <li><a id="ooSignInLink" href="#/login" class="menuLink">Sign In</a></li>
               <li><a id="ooSignOutLink" href="#/logout" class="menuLink">Sign Out</a></li>
              <li><a href="https://okobserver.org" target="_blank" rel="noopener">Go to Website</a></li>

    </ul>
  </nav>

  <!-- App root -->
  <main id="app" role="main"></main>

  <!-- Splash / hero video container -->
  <div class="oo-splash" aria-hidden="false">
    <video
      id="oo-splash-video"
      class="oo-splash-video"
      preload="auto"
      autoplay
      muted
      loop
      playsinline
    >
      <!-- New splash video file -->
      <source
        src="Newspaper_Rolls_Into_Cartoon_Cell_Phone.mp4?v=2025-12-06R1-splash"
        type="video/mp4"
      />
      <!-- Fallback -->
      Your browser does not support the video tag.
    </video>
  </div>

  <!-- MutationObserver grid enforcer (must remain) -->
  
  <script>
    // ðŸŸ¢ index.html â€” inline header script start
    (function () {
      function initHeader() {
        var hamburger = document.querySelector('[data-oo="hamburger"]');
        var overlay = document.querySelector('[data-oo="overlay"]');
        var menu = document.querySelector('[data-oo="menu"]');

        if (!hamburger || !overlay || !menu) {
          console.warn('[OkObserver] Header script: elements not found');
          return;
        }

        function setOpen(isOpen) {
  document.body.classList.toggle('is-menu-open', isOpen);
  hamburger.setAttribute('aria-expanded', isOpen ? 'true' : 'false');
  overlay.hidden = !isOpen;

  if (isOpen) {
    // Focus first link for keyboard users
    var firstLink = menu.querySelector('a');
    if (firstLink) firstLink.focus();
  } else {
    // Return focus to hamburger
    hamburger.focus();
  }
}
function syncAuthClass() {
  try {
    var isLoggedIn = localStorage.getItem('ooLoggedIn') === '1';
    document.body.classList.toggle('oo-logged-in', isLoggedIn);
  } catch (e) {
    document.body.classList.remove('oo-logged-in');
  }
}


       hamburger.addEventListener('click', function (evt) {
  evt.preventDefault();
  syncAuthClass();
  var isOpen = !document.body.classList.contains('is-menu-open');
  setOpen(isOpen);
});


        overlay.addEventListener('click', function () {
          setOpen(false);
        });

        menu.addEventListener('click', function (evt) {
          var target = evt.target;
          if (target && target.tagName === 'A') {
            setOpen(false);
          }
        });

        
window.addEventListener('hashchange', function () {
  syncAuthClass();
  setOpen(false);
});
syncAuthClass();

        console.log('[OkObserver] Header script initialized.');
      }

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initHeader);
      } else {
        initHeader();
      }
    })();
    // ðŸ”´ index.html â€” inline header script end
  </script>

  <script>
    // ðŸŸ¢ index.html â€” grid-enforcer start of file
    (function () {
      function enforceGrid() {
        const grid = document.querySelector('#app .posts-grid');
        if (!grid) return;
        grid.querySelectorAll('.post-card').forEach(function (card) {
          card.classList.add('post-card');
        });
      }

      const app = document.getElementById('app');
      if (app) {
        const mo = new MutationObserver(enforceGrid);
        mo.observe(app, { childList: true, subtree: true });
      }

      window.addEventListener('hashchange', enforceGrid);
      document.addEventListener('okobs:route', enforceGrid);
      setInterval(enforceGrid, 1500);
    })();
    // ðŸ”´ index.html â€” grid-enforcer end of file
  </script>

  <!-- Service worker registration (must stay in index.html, not main.js) -->
  <script>
    (function () {
      if (!('serviceWorker' in navigator)) {
        console.log('[OkObserver] SW not supported in this browser.');
        return;
      }

      var SW_BUILD = '2026-01-05R066'; // bump when sw.js changes
      var SW_URL = '/okobserver/sw.js';
      var SCOPE = '/okobserver/';

            window.addEventListener('load', function () {
        navigator.serviceWorker
          .getRegistration(SCOPE)
          .then(function (reg) {
            if (!reg) return;
            if (!reg.active) return;
            if (!reg.active.scriptURL) return;
            if (reg.active.scriptURL.indexOf(SW_BUILD) === -1) {
              console.log('[OkObserver] SW build mismatch, unregisteringâ€¦');
              return reg.unregister();
            }
          })
          .catch(function (err) {
            console.warn('[OkObserver] SW getRegistration error:', err);
          })
          .then(function () {
            return navigator.serviceWorker.register(SW_URL + '?v=' + SW_BUILD, {
              scope: SCOPE,
              updateViaCache: 'none'
            });
          })
          .then(function (reg) {
            if (reg) console.log('[OkObserver] SW registered:', reg.scope);
          })
          .catch(function (err) {
            console.warn('[OkObserver] SW register error:', err);
          });
      });
    })();
  </script>

  <!-- Splash hide logic: show only while first posts are loading -->
  <script>
    (function () {
      var splash = document.querySelector('.oo-splash');
      if (!splash) return;

      // If we've already shown splash in this tab, hide instantly and never show again
      if (window.__OO_SPLASH_SHOWN_ONCE__) {
        splash.style.opacity = '0';
        splash.style.visibility = 'hidden';
        splash.style.pointerEvents = 'none';
// Stop/unload splash video so it cannot keep streaming in the background
var vid = document.getElementById('oo-splash-video');
if (vid) {
  try { vid.pause(); } catch (e) {}
  try {
    var sources = vid.querySelectorAll('source');
    for (var i = 0; i < sources.length; i++) {
      sources[i].removeAttribute('src');
    }
    vid.removeAttribute('src');
    vid.load(); // forces browser to release the media resource
  } catch (e2) {}
}

        return;
      }

      function hideSplash() {
        if (!splash || splash.__ooHidden) return;
        splash.__ooHidden = true;

        splash.style.opacity = '0';
        splash.style.visibility = 'hidden';
        splash.style.pointerEvents = 'none';
// Stop/unload splash video so it cannot keep streaming in the background
var vid = document.getElementById('oo-splash-video');
if (vid) {
  try { vid.pause(); } catch (e) {}
  try {
    var sources = vid.querySelectorAll('source');
    for (var i = 0; i < sources.length; i++) {
      sources[i].removeAttribute('src');
    }
    vid.removeAttribute('src');
    vid.load(); // forces browser to release the media resource
  } catch (e2) {}
}


        window.__OO_SPLASH_SHOWN_ONCE__ = true;
      }

      function checkGridReady() {
        var grid = document.querySelector('#app .posts-grid');
        if (!grid) return;
        var cards = grid.querySelectorAll('.post-card');
        if (cards.length > 0) {
          hideSplash();
        }
      }

      // Watch #app for the first batch of post cards
      var appRoot = document.getElementById('app');
      if (appRoot && window.MutationObserver) {
        var observer = new MutationObserver(checkGridReady);
        observer.observe(appRoot, { childList: true, subtree: true });
      }

      // Safety: never get stuck on splash â€“ hide after 7s max
      setTimeout(hideSplash, 7000);

      // Initial check when DOM is ready
      if (document.readyState === 'complete' || document.readyState === 'interactive') {
        checkGridReady();
      } else {
        document.addEventListener('DOMContentLoaded', checkGridReady);
      }
    })();
  </script>
</body>
</html>
<!-- ðŸ”´ index.html â€” end of file -->
<!-- ðŸ”´ index.html -->
